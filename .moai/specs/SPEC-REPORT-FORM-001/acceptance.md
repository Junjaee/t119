# SPEC-REPORT-FORM-001 인수 테스트

> **신고 작성 및 제출 페이지 인수 기준 (Given-When-Then)**

---

## 1. 정상 신고 작성 및 제출

### 시나리오 1-1: 파일 없이 신고 제출
```gherkin
Feature: 신고 작성 및 제출
  교사는 교권 침해 사건을 신고할 수 있다

Scenario: 파일 없이 신고 제출
  Given 교사가 /reports/new 페이지에 접근했고
    And 신고 폼이 로드되었을 때
  When  교사가 다음 정보를 입력하고
    | 필드         | 값                              |
    | 카테고리     | "학부모"                        |
    | 제목         | "학부모 폭언 사건"              |
    | 설명         | "수업 중 학부모로부터 폭언을 받았습니다" |
    | 사건 날짜    | "2025-10-23"                    |
    | 우선순위     | "high"                          |
    And '제출' 버튼을 클릭할 때
  Then  시스템은 POST /api/reports API를 호출하고
    And 응답 상태 코드는 201이며
    And 신고 목록 페이지(/reports)로 리다이렉트되고
    And '신고가 접수되었습니다' 토스트 메시지가 표시되어야 한다
```

### 시나리오 1-2: 파일 포함 신고 제출
```gherkin
Scenario: 파일 포함 신고 제출
  Given 교사가 /reports/new 페이지에 접근했고
    And 신고 폼이 로드되었을 때
  When  교사가 필수 정보를 입력하고
    And 2개의 파일을 업로드하고
    | 파일명       | 크기    | 형식 |
    | evidence1.jpg| 2.3MB   | jpg  |
    | evidence2.pdf| 1.5MB   | pdf  |
    And '제출' 버튼을 클릭할 때
  Then  시스템은 먼저 파일을 Supabase Storage에 업로드하고
    And 파일 URL을 포함하여 POST /api/reports API를 호출하고
    And 응답 상태 코드는 201이며
    And 신고 목록 페이지(/reports)로 리다이렉트되어야 한다
```

---

## 2. 필수 필드 검증

### 시나리오 2-1: 필수 필드 미입력
```gherkin
Scenario: 필수 필드 미입력 시 제출 차단
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 제목만 입력하고
    And '제출' 버튼을 클릭하려고 시도할 때
  Then  시스템은 '제출' 버튼을 비활성화하고
    And 다음 에러 메시지를 표시해야 한다
    | 필드         | 에러 메시지                     |
    | 카테고리     | "카테고리를 선택해주세요"       |
    | 설명         | "설명은 20자 이상이어야 합니다" |
    | 사건 날짜    | "사건 날짜를 선택해주세요"      |
    | 우선순위     | "우선순위를 선택해주세요"       |
```

### 시나리오 2-2: 제목 길이 검증
```gherkin
Scenario: 제목이 5자 미만인 경우
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 제목에 "신고"(2자)를 입력할 때
  Then  시스템은 '제목은 5자 이상이어야 합니다' 에러 메시지를 표시하고
    And '제출' 버튼을 비활성화해야 한다

Scenario: 제목이 100자를 초과하는 경우
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 제목에 101자를 입력하려고 시도할 때
  Then  시스템은 '제목은 100자 이하여야 합니다' 에러 메시지를 표시해야 한다
```

### 시나리오 2-3: 설명 길이 검증
```gherkin
Scenario: 설명이 20자 미만인 경우
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 설명에 "폭언"(2자)을 입력할 때
  Then  시스템은 '설명은 20자 이상이어야 합니다' 에러 메시지를 표시하고
    And '제출' 버튼을 비활성화해야 한다

Scenario: 설명이 2000자를 초과하는 경우
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 설명에 2001자를 입력하려고 시도할 때
  Then  시스템은 '설명은 2000자 이하여야 합니다' 에러 메시지를 표시해야 한다
```

### 시나리오 2-4: 사건 날짜 검증
```gherkin
Scenario: 미래 날짜 선택 차단
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 사건 날짜에 내일 날짜를 선택할 때
  Then  시스템은 '미래 날짜는 선택할 수 없습니다' 에러 메시지를 표시하고
    And '제출' 버튼을 비활성화해야 한다
```

---

## 3. 파일 업로드 기능

### 시나리오 3-1: 파일 드래그&드롭 업로드
```gherkin
Scenario: 파일 드래그&드롭 업로드
  Given 교사가 신고 폼 작성 중일 때
  When  교사가 파일 업로드 영역에 파일을 드래그&드롭할 때
  Then  시스템은 파일을 폼에 추가하고
    And 파일 목록에 파일 정보를 표시해야 한다
    | 파일명       | 크기    | 삭제 버튼 |
    | evidence1.jpg| 2.3MB   | [✕]       |
```

### 시나리오 3-2: 파일 선택 버튼으로 업로드
```gherkin
Scenario: 파일 선택 버튼으로 업로드
  Given 교사가 신고 폼 작성 중일 때
  When  교사가 '파일 선택' 버튼을 클릭하고
    And 파일 선택 다이얼로그에서 파일을 선택할 때
  Then  시스템은 파일을 폼에 추가하고
    And 파일 목록에 파일 정보를 표시해야 한다
```

### 시나리오 3-3: 파일 삭제
```gherkin
Scenario: 업로드된 파일 삭제
  Given 교사가 2개의 파일을 업로드한 상태일 때
  When  교사가 첫 번째 파일의 삭제 버튼([✕])을 클릭할 때
  Then  시스템은 해당 파일을 목록에서 제거하고
    And 파일 카운트를 업데이트해야 한다
```

### 시나리오 3-4: 파일 크기 초과
```gherkin
Scenario: 파일 크기 10MB 초과 시 차단
  Given 교사가 신고 폼 작성 중일 때
  When  교사가 12MB 크기의 파일을 업로드하려고 시도할 때
  Then  시스템은 다음 에러 메시지를 표시해야 한다
    | 메시지 | "파일이 너무 큽니다 (최대 10MB)" |
    And 파일 업로드를 차단해야 한다
```

### 시나리오 3-5: 파일 개수 초과
```gherkin
Scenario: 파일 개수 5개 초과 시 차단
  Given 교사가 이미 5개의 파일을 업로드한 상태일 때
  When  교사가 6번째 파일을 업로드하려고 시도할 때
  Then  시스템은 다음 에러 메시지를 표시해야 한다
    | 메시지 | "최대 5개까지 업로드 가능합니다" |
    And 추가 업로드를 차단해야 한다
```

### 시나리오 3-6: 지원하지 않는 파일 형식
```gherkin
Scenario: 지원하지 않는 파일 형식 차단
  Given 교사가 신고 폼 작성 중일 때
  When  교사가 .exe 파일을 업로드하려고 시도할 때
  Then  시스템은 다음 에러 메시지를 표시해야 한다
    | 메시지 | "지원하지 않는 파일 형식입니다" |
    And 파일 업로드를 차단해야 한다
```

---

## 4. 실시간 검증 피드백

### 시나리오 4-1: 제목 입력 중 실시간 검증
```gherkin
Scenario: 제목 입력 중 실시간 검증
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 제목 필드에 "학부모"(3자)를 입력하고 포커스를 벗어날 때
  Then  시스템은 '제목은 5자 이상이어야 합니다' 에러 메시지를 즉시 표시해야 한다
  When  교사가 "학부모 폭언"(6자)으로 수정할 때
  Then  시스템은 에러 메시지를 제거하고
    And 필드 테두리를 녹색으로 표시해야 한다
```

### 시나리오 4-2: 설명 문자 수 카운터
```gherkin
Scenario: 설명 입력 중 문자 수 카운터
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 설명 필드에 텍스트를 입력할 때
  Then  시스템은 실시간으로 현재 문자 수를 표시해야 한다
    | 입력 문자 수 | 표시          |
    | 15          | "15 / 2000"   |
    | 2000        | "2000 / 2000" |
```

---

## 5. 에러 처리

### 시나리오 5-1: 네트워크 오류
```gherkin
Scenario: 네트워크 연결 실패
  Given 교사가 신고 폼을 작성하고 '제출' 버튼을 클릭했을 때
  When  네트워크 연결이 끊어진 상태일 때
  Then  시스템은 다음 에러 메시지를 표시해야 한다
    | 메시지 | "네트워크 연결을 확인해주세요" |
    And 폼 데이터를 유지해야 한다
```

### 시나리오 5-2: 인증 실패
```gherkin
Scenario: 인증 세션 만료
  Given 교사가 신고 폼을 작성하고 '제출' 버튼을 클릭했을 때
  When  세션이 만료된 상태일 때
  Then  시스템은 로그인 페이지(/auth/login)로 리다이렉트해야 한다
    And 리다이렉트 후 원래 페이지(/reports/new)로 돌아오도록 returnUrl을 설정해야 한다
```

### 시나리오 5-3: 서버 오류
```gherkin
Scenario: 서버 내부 오류 (500)
  Given 교사가 신고 폼을 작성하고 '제출' 버튼을 클릭했을 때
  When  서버에서 500 에러를 반환할 때
  Then  시스템은 다음 에러 메시지를 표시해야 한다
    | 메시지 | "서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요" |
    And 폼 데이터를 유지해야 한다
```

---

## 6. 로딩 상태

### 시나리오 6-1: 제출 중 로딩 상태
```gherkin
Scenario: 신고 제출 중 로딩 상태
  Given 교사가 신고 폼을 작성하고 '제출' 버튼을 클릭했을 때
  When  API 응답을 기다리는 중일 때
  Then  시스템은 다음을 표시해야 한다
    | UI 요소         | 상태                |
    | 제출 버튼 텍스트 | "제출 중..."        |
    | 제출 버튼 상태   | 비활성화            |
    | 로딩 스피너     | 표시                |
    And 다른 폼 필드는 입력 불가 상태로 변경해야 한다
```

### 시나리오 6-2: 파일 업로드 중 로딩 상태
```gherkin
Scenario: 파일 업로드 중 로딩 상태
  Given 교사가 5MB 크기의 파일을 업로드할 때
  When  파일이 Supabase Storage에 업로드되는 중일 때
  Then  시스템은 다음을 표시해야 한다
    | UI 요소         | 상태                |
    | 프로그레스 바   | 업로드 진행률 (%)   |
    | 상태 텍스트     | "업로드 중..."      |
```

---

## 7. 선택 기능 (Optional)

### 시나리오 7-1: 로컬스토리지 임시 저장
```gherkin
Scenario: 작성 중 데이터 임시 저장
  Given 교사가 신고 폼을 작성 중일 때
  When  교사가 페이지를 이탈하려고 할 때
  Then  시스템은 현재 폼 데이터를 로컬스토리지에 저장하고
    And '작성 중인 내용을 저장하시겠습니까?' 확인 팝업을 표시해야 한다
```

### 시나리오 7-2: 임시 저장 데이터 복구
```gherkin
Scenario: 이전 작성 내용 복구
  Given 교사가 이전에 작성 중이던 데이터가 로컬스토리지에 있을 때
  When  교사가 /reports/new 페이지에 접근할 때
  Then  시스템은 다음 팝업을 표시해야 한다
    | 메시지 | "이전에 작성하던 내용을 복구하시겠습니까?" |
    | 버튼   | [복구하기] [새로 작성] [취소]             |
  When  교사가 [복구하기]를 클릭할 때
  Then  시스템은 로컬스토리지의 데이터를 폼에 채워야 한다
```

---

## 8. 접근성 (Accessibility)

### 시나리오 8-1: 키보드 네비게이션
```gherkin
Scenario: Tab 키로 폼 필드 이동
  Given 교사가 /reports/new 페이지에 있을 때
  When  교사가 Tab 키를 누를 때
  Then  시스템은 다음 순서로 포커스를 이동해야 한다
    | 순서 | 필드          |
    | 1    | 카테고리      |
    | 2    | 제목          |
    | 3    | 설명          |
    | 4    | 사건 날짜     |
    | 5    | 우선순위      |
    | 6    | 파일 업로드   |
    | 7    | 제출 버튼     |
```

### 시나리오 8-2: 스크린 리더 지원
```gherkin
Scenario: 스크린 리더로 에러 메시지 읽기
  Given 교사가 스크린 리더를 사용 중일 때
  When  필수 필드에 에러가 발생할 때
  Then  시스템은 aria-describedby 속성으로 에러 메시지를 연결해야 하고
    And 스크린 리더가 "제목 필드, 필수, 에러: 제목은 5자 이상이어야 합니다"를 읽어야 한다
```

---

## 9. 반응형 디자인

### 시나리오 9-1: 모바일 레이아웃
```gherkin
Scenario: 모바일 화면 (< 768px)에서 폼 표시
  Given 교사가 모바일 기기(375px 너비)로 접속했을 때
  When  /reports/new 페이지를 열 때
  Then  시스템은 다음과 같이 표시해야 한다
    | UI 요소         | 표시              |
    | 폼 너비         | 100%              |
    | 버튼 너비       | 100%              |
    | 필드 레이아웃   | 세로 스택         |
```

### 시나리오 9-2: 데스크톱 레이아웃
```gherkin
Scenario: 데스크톱 화면 (≥ 1024px)에서 폼 표시
  Given 교사가 데스크톱 브라우저로 접속했을 때
  When  /reports/new 페이지를 열 때
  Then  시스템은 다음과 같이 표시해야 한다
    | UI 요소         | 표시              |
    | 폼 너비         | 최대 800px        |
    | 폼 정렬         | 중앙 정렬         |
    | 버튼 정렬       | 우측 정렬         |
```

---

## 10. 성능 요구사항

### 시나리오 10-1: 페이지 로드 시간
```gherkin
Scenario: 신고 폼 페이지 로드
  Given 교사가 /reports/new 페이지에 접근할 때
  When  페이지가 로드될 때
  Then  시스템은 2초 이내에 폼을 렌더링해야 한다
```

### 시나리오 10-2: 파일 업로드 시간
```gherkin
Scenario: 5MB 파일 업로드
  Given 교사가 5MB 파일을 업로드할 때
  When  파일이 Supabase Storage에 업로드될 때
  Then  시스템은 5초 이내에 업로드를 완료해야 한다
```

---

## Definition of Done (완료 조건)

### 기능 완료
- [x] 모든 필수 필드 입력 가능
- [x] Zod 검증 통과
- [x] 파일 업로드 (최대 5개, 10MB) 가능
- [x] POST /api/reports API 연동 완료
- [x] 제출 성공 시 /reports로 리다이렉트
- [x] 에러 처리 (네트워크, 인증, 서버)

### 품질 게이트
- [x] 테스트 커버리지 ≥ 85%
- [x] 모든 시나리오 E2E 테스트 통과
- [x] 접근성 WCAG 2.1 AA 준수
- [x] Lighthouse 성능 점수 ≥ 90
- [x] 모바일/데스크톱 반응형 동작 확인

### 문서화
- [x] API 문서 작성
- [x] 컴포넌트 JSDoc 작성
- [x] 사용자 가이드 작성 (선택)

---

**작성자**: @Alfred
**최종 업데이트**: 2025-10-23
